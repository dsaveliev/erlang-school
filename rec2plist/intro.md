# Конвертация record -> proplist -> record.

Если вы разрабатываете веб-приложение, то наверняка используете JSON
для обмена данными с клиентом. Вполне может быть, что JSON вы
используете, даже если ваш проект не веб :) Между тем, в Erlang
ествественный способ хранения и передачи данных -- это record. Стало
быть, вам нужно будет конвертировать данные в обе стороны между record
и JSON. Давайте посмотрим, что тут можно сделать, и как с этим жить.

Опытным Erlang-разработчикам покажется, что я пишу слишком упрощенно,
и слишком долго подхожу к конечному результату. Это не случайно, ибо я
не просто пишу пост, а готовлю материал для обучения начинающих
разработчиков. Конечная цель -- подготовить хороший учебный курс по
Erlang. И данный пост -- один из шагов к этой цели.

Итак, допустим, у нас в проекте есть такие вот records:

    -record(user, {id = 0 :: integer(),
                   name = <<>> :: binary(),
                   avatar = <<>> :: binary(),
                   level = 0 :: integer()}).

    -record(comment, {id = 0 :: integer(),
                      user_id = 0 :: integer(),
                      text = <<>> :: binary()}).


И мы хотим превратить их в JSON объекты, чтобы передать клиенту. Берем
какой-нибудь JSON-парсер, например
[jsonx](https://github.com/iskra/jsonx), и выясняется, что record он
не принимает, а ему нужно передать proplist вот такого вида:

    [{<<"id">>, 6},
     {<<"name">>, <<"Bob">>},
     {<<"avatar">>, <<>>},
     {<<"level">>, 5}]

  - [Шаг 1-й, конвернируем вручную.](./step_1.md)
  - [Шаг 2-й, простая автоматизация.](./step_2.md)
  - [Шаг 3-й, учитываем вложенные рекорды.](./step_3.md)
  - [Шаг 4-й, учитываем вложенные списки рекордов.](./step_4.md)
  - Шаг 5-й, автоматическая генерация кода.
  - Шаг 6-й, плагин для rebar.

